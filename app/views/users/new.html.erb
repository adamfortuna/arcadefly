<% content_for(:header) do %>
  <script>
	function set_address_status(status) {
	  $$('#address input').each( function(e) {
	  	$(e).disabled = status;
	  });
	  $$('#address select').each( function(e) {
	  	$(e).disabled = status;
	  });
		
		// Remove the error messages on the address field if it's disabled
		$$('#address .formError').each( function(e) {
			if (status) {
				$(e).addClassName('hidden');
			}	else {
				$(e).removeClassName('hidden');
			}
		});
		
		if (status) {
			$$('#address .fieldWithErrors').each( function(e) {
				$(e).removeClassName('fieldWithErrors');
				$(e).addClassName('fieldWithErrorsDisabled');
			});
		} else {
			$$('#address .fieldWithErrorsDisabled').each( function(e) {
				$(e).removeClassName('fieldWithErrorsDisabled');
				$(e).addClassName('fieldWithErrors');
			});			
		}
		// Remove the red outline around address fields if it's disabled
		
	}

    Event.observe(window, 'load', function() {
      Form.focusFirstElement('signup_form');
      $('add_address').observe('click', function() {
        if ($('add_address').checked) {
          $('address_country_id').selectedIndex = 1;
          set_address_status(false);
				  $('address').removeClassName('disabled');
        } else {
				  set_address_status(true);
		  		$('address').addClassName('disabled');
        }
      });
	<% if !@add_address %>
		set_address_status(true);
    $('address').addClassName('disabled');
	<% end %>
	});
	
	
  </script>
<% end %>

<% title "Signup for an Account" %>
<div class="block_outside">
  <div class="block_inside">
    <h2>Signup for an Account</h2>
    <% form_for :user, :url => users_path, :html => { :id => 'signup_form' } do |f| -%>
  
    <div class="left">
      <% fields_for :profile, @user.profile do |p| %>
        <p class="block required">
          <label for="profile_display_name">Display Name</label>
          <span class="block info">Whenever we show your name on ArcadeFly, this is what people will see. You can change this whenever.</span>
          <%= error_message_on @user.profile, "display_name", "Display Name " %>
          <%= p.text_field :display_name, { :class => 'text'} %>
        </p>

      <p class="block required">
        <label for="profile_email">Email Address</label>
        <span class="block info">You'll use this to login and to activate your account.</span>
        <%= error_message_on @user.profile, "email", "Email " %>
        <%= p.text_field :email, { :class => 'text'} %>
      </p>
      
      <p class="block required">
        <label for="profile_email_confirmation">Confirm Email Address</label>
        <%= error_message_on @user.profile, "email_confirmation", "Email " %>
        <%= p.text_field :email_confirmation, { :class => 'text'} %>
      </p>
      
      <% end %>
      
      <p class="block required">
        <label for="user_password">Choose a Password</label>
        <span class="block info">At least 4 characters.</span>
        <%= error_message_on "user", "password", "Password " %>
        <%= f.password_field :password, { :class => 'text'} %>
      </p>
      
      <p class="block required">
        <label for="user_password_confirmation">Confirm your Password</label>
        <%= error_message_on "user", "password_confirmation", "Confirm password " %>
        <%= f.password_field :password_confirmation, { :class => 'text'} %>
      </p>

      <p class="left shift-1">
        <input type="checkbox" name="add_address" id="add_address"<%= ' checked="true"' if @add_address %> />
        <label for="add_address">Add an address now?</label>
        <span class="small block">Adding an address will let us show distinace calculations</span>
      </p>
    </div>
    
    <div class="right" id="address">
      <%= render :partial => 'shared/address', :locals => { :address => @user.profile.address } %>
    </div>

    <p class="right">
      <%= submit_tag 'Register', { :disable_with => 'Registering...' } %>
    </p

    <% end -%>
  </div>
</div>