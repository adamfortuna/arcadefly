<%- 
  # Example:
  #  render :partial => 'shared/addressables', :object => arcades, :locals => {:small_map => true, :map_type => false, :id => "#{addressables.first.class.to_s.downcase}_map"}

  options ||= {}
  options.reverse_merge!({:small_map => true, :map_type => false, :id => "#{addressables.first.class.to_s.downcase}_map", :class => "map map_medium content-height"})

  map = GMap.new(options[:id])
  map.control_init(options)
  map.center_zoom_init([26,-80], 6)
  
  markers = {}
  addressables.each do |addressable|
    markers.merge!("'#{addressable.permalink}'" => GMarker.new([addressable.address.lat, addressable.address.lng],
                           :title => addressable.title,
                           :info_window => map_bubble_for(addressable)))
  end
  
  gmarker_group = GMarkerGroup.new(true, markers)
  map.overlay_global_init(gmarker_group,"#{addressables.first.class.to_s.downcase}_group")
  
  sorted_latitudes = addressables.collect(&:address).collect(&:lat).compact.sort
  sorted_longitudes = addressables.collect(&:address).collect(&:lng).compact.sort
  map.center_zoom_on_bounds_init([ [sorted_latitudes.first, sorted_longitudes.first], 
                                   [sorted_latitudes.last, sorted_longitudes.last]])
-%>

<% content_for(:header) do %>
  <%= GMap.header(:with_vml => false) %>
  <%= javascript_include_tag("markerGroup") %>
<% end %>

<% javascript do %>
	<%= map.to_html(:no_script_tag => true) %>
<% end %>

<%= map.div(:class => options[:class]) %>